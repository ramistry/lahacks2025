<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #ece9e6, #ffffff);
    }
    .glass {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      overflow-y: auto;
    }
    .navbar {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

<!-- Navbar -->
<nav class="navbar flex justify-between items-center p-6">
  <!-- Logo -->
  <a href="/" class="flex items-center space-x-3">
    <img src="/static/logo.png" alt="Ment2Meet Logo" class="w-20 h-20">
    <span class="text-2xl font-bold text-gray-800"></span>
  </a>
</nav>

<!-- Chat Section -->
<section class="flex-1 flex flex-col items-center p-6 space-y-4">
  
    <!-- Scrollable Chat Container -->
    <div id="chatContainer" class="glass p-8 max-w-2xl w-full flex flex-col space-y-6 overflow-y-auto" style="height: 65vh;">
      {% for msg in messages %}
        {% if not loop.first %}
          {% if msg.role == 'user' %}
            <div class="self-end animate__animated animate__fadeInUp bg-gray-900 text-white px-5 py-3 rounded-2xl max-w-xs shadow-md">
              {{ msg.content }}
            </div>
          {% else %}
            <div class="self-start animate__animated animate__fadeInUp bg-white text-gray-800 px-5 py-3 rounded-2xl max-w-xs shadow-md">
              {{ msg.content }}
            </div>
          {% endif %}
        {% endif %}
      {% endfor %}
  
      {% if response_text is none %}
        <!-- Typing Indicator inside glass -->
        <div id="typingIndicator" class="self-start text-gray-600 animate__animated animate__pulse animate__infinite">
          {{ name }} is typing...
        </div>
      {% endif %}
    </div>
  
    <!-- Input Form (ALWAYS stuck at bottom) -->
    <form method="POST" class="flex w-full max-w-2xl mt-4 space-x-3">
      <input type="text" name="message" placeholder="Type your message..." class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-900" required>
      <button type="submit" class="bg-gray-900 hover:bg-gray-700 text-white font-bold px-6 rounded-lg transition-all transform hover:scale-105 active:scale-95">
        ‚úâÔ∏è Send
      </button>
    </form>
  
    <!-- Connect IRL - Send an Email Button Form -->
    <button id="connectButton" class="bg-gray-500 hover:bg-black-400 text-white font-bold px-6 py-3 rounded-lg transition-all transform hover:scale-105 active:scale-95 mt-3">
      Connect IRL - send an email!
    </button>
    
    <!-- Email Modal -->
    <div id="emailModal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center hidden">
      <div class="bg-white p-8 rounded-lg max-w-md w-full">
        <h3 class="text-lg font-bold mb-4">Enter your Email to Connect</h3>
        <form id="emailForm" method="POST" action="/send-email/{{ mentor.id }}">
          <input type="email" name="email" placeholder="Your Email Address" required class="w-full p-3 border border-gray-300 rounded mb-4">
          <button type="submit" class="bg-gray-500 hover:bg-black-400 text-white font-bold px-6 py-3 rounded-lg w-full">
            Send Email
          </button>
        </form>
        <button id="closeModalButton" class="mt-4 text-red-500">Close</button>
      </div>
    </div>
    
    <!-- Reset Button -->
    <form action="/reset" method="GET" class="mt-3">
      <button type="submit" class="text-gray-700 hover:underline text-xs">üîÑ Start New Chat</button>
    </form>
  </section>  

<!-- Footer -->
<footer class="text-center text-gray-400 text-xs p-4 mt-12">
  Built with ‚ù§Ô∏è by Ment2Meet Team
</footer>

<!-- Final Scripts -->
<script>
  window.onload = function() {
    const chatContainer = document.getElementById('chatContainer');
    if (chatContainer) {
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
      setTimeout(() => {
        typingIndicator.style.display = 'none';
      }, 2000); // Hide after 2 seconds or when response comes
    }

    // Open modal when "Connect IRL" button is clicked
    const connectButton = document.getElementById('connectButton');
    const emailModal = document.getElementById('emailModal');
    const closeModalButton = document.getElementById('closeModalButton');
    
    connectButton.addEventListener('click', () => {
      emailModal.classList.remove('hidden');
    });

    // Close modal when "Close" button is clicked
    closeModalButton.addEventListener('click', () => {
      emailModal.classList.add('hidden');
    });
  };
</script>

</body>
</html>
